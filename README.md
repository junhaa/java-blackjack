# 기능 요구 사항

블랙잭 게임을 변형한 프로그램을 구현한다.
블랙잭 게임은 딜러와 플레이어 중 카드의 합이 21 또는 21에 가장 가까운 숫자를 가지는 쪽이 이기는 게임이다.

## 기능 구현 목록

### 카드

- [x] 카드는 조커를 제외한 52장을 활용한다
- [x] 중복되는 카드는 존재하지 않는다
- [x] 에이스는 1 또는 11의 값을 가질 수 있다
- [x] 에이스는 21을 넘지 않는 숫자 중에 플레이어에게 유리한 숫자로 취급한다.
- [x] J,Q,K는 10으로 취급한다

### 참여자 이름 입력

- [x] 게임에 참여할 플레이어를 입력받는다
    - [x] 플레이어 이름 입력 안내메세지를 출력한다.
    - [x] 이름을 입력한다.
        - [x] 이름은 영어, 숫자, 한글로만 구성된다.
        - [x] 이름의 길이는 1이상 15이하로 구성된다.
    - [x] 플레이어는 최소 1명이상 최대 8명까지 참여할 수 있다.

### 배팅 금액 확정

- [x] 플레이어들은 배팅금액을 결정한다

### 블랙잭 게임 실행

#### 초기 카드 분배

- [x] 카드를 셔플한다.
- [x] 딜러를 포함한 각 참여자에게 2장의 카드를 분배한다

#### 초기 카드패 출력

- [x] 딜러를 포함한 참여자들의 카드패를 공개한다
    - [x] 딜러의 초기 카드패 2장 중 한장을 출력한다
    - [x] 플레이어들의 이름과 카드패를 출력한다

#### 플레이어의 카드패 확정

- [x] 각 플레이어들은 본인의 카드패를 확정한다
    - [x] 플레이어에게 카드 분배 여부를 물어본다
        - [x] 플레이어가 `y`를 입력하여 승낙하면 카드를 한 장 더 분배한다
        - [x] 플레이어가 `n`을 입력하여 거부하면 카드를 분배하지 않는다
        - [x] 플레이어의 카드 패 합이 21을 넘지 않으면 다시 분배여부를 물어본다
        - [x] 플레이어의 카드 패 합이 21을 넘으면 더이상 물어보지 않는다
        - [x] `y`와`n`의 대소문자는 구분하지 않는다
        - [x] `y`와 `n`이외의 입력이 들어오면 예외를 발생시킨다

#### 딜러의 카드패 확정

- [x] 딜러의 초기 카드패에 따라 카드를 받는다.
    - [x] 초기 카드패의 합계가 16이하이면 반드시 1장의 카드를 추가로 받는다
    - [x] 초기 카드패의 합계가 17이상이면 카드를 더 이상 받지 않는다
    - [x] 딜러의 카드 추가여부를 출력한다

### 플레이어와 딜러의 최종 카드패와 점수 출력

- [x] 딜러의 최종 카드패와 점수를 출력한다
- [x] 게임에 참여한 플레이어들의 최종 카드패와 점수를 출력한다

### 게임 결과 계산

- [x] 각 플레이어별로 승패를 계산한다
    - [x] 플레이어의 승리 : 딜러의 게임 패보다 21에 가까울 때
    - [x] 플레이어의 패배 : 딜러의 게임 패보다 21에서 멀 때
    - [x] 무승부 : 딜러의 게임패와 플레이어의 게임패 합이 같을 때
    - [x] 무승부 : 딜러와 참여자 모두 21을 초과했을 때
- [x] 딜러를 기준으로 전체 게임결과를 수합한다

### 게임 결과 출력

- [x] 딜러를 포함한 각 플레이어의 카드패를 출력한다
- [x] 딜러의 게임 결과를 출력한다
- [x] 각 플레이어의 이름과 수익을 출력한다
    - [x] 승리하면 배팅한 금액만큼 수익을 얻는다
    - [x] 처음 두 장이 블랙잭이면 1.5배를 받는다
    - [x] 플레이어와 딜러가 동시에 블랙잭이면 베팅한 금액을 돌려받는다
    - [x] 21을 초과할 경우 배팅 금액을 모두 잃는다


## 1차 리뷰 개선사안

- controller/GameController : Game 생성 로직에서 예외처리


- domain : Map 생성자 인수 개선 
  - 확장성을 고려하여 각자에게 필요한 인수만으로 리팩터링
- gameResult/Profit : 최대/최소 수익이 아닌 수익률을 가지고 있도록 수정
- gameResult/Profit : Batting 객체를 통한 최대/최소 수익 계산
- gameResult : 승패 판정 책임과 결과에 따른 수익 반환 책임 분리
  - Result(enum) : 승패 판정
  - ResultProfit(enum) : 승패에 따른 수익 반환
- card/Card : 해당 카드 번호를 가졌는지 메시지를 반환하는 메서드 추가
- hands/HandsScore : BLACK_JACK 점수 객체를 반환하는 정적 팩토리 메서드 추가
- hands/HandsScore : 자주 사용되는 스코어 인스턴스 캐싱
- participant : 딜러 이름 관리 책임 이전 (Name > Dealer)
- 스트림 orElseThrow를 통한 Optional 타입 값 예외처리
- eq & hc 컨벤션 준수를 통한 코드 가독성 개선
- 불필요한 TODO 및 주석 삭제

- view: 컨벤션 준수를 통한 코드 가독성 개선
- test/BattingTest : 성공/실패 각각의 테스트 케이스 추가
- test/ProfitTest : 성공/실패 각각의 테스트 케이스 추가 

## 2차 리뷰 개선사안
- 상속관계 Participants 삭제
- 베팅을 관리하는 GameBattings 객체 추가
- 게임 결과 판단에 대한 책임을 Game으로 이전하여 Map<Player, Profit>을 GameResult에게 넘겨줌
- 결과와 결과조건에 대한 책임 분리
  - Result : 승패 결과만을 대변
  - ResultJudge : 승패 판단 
- GameResult : 딜러 수익 결과 반환 로직 추가
- Profit : 범위 검증 과정 삭제
- rename: Value > CardNumber 


## 3차 리뷰 개선사안
- 상속관계인 Participant 추상 클래스 롤백
- Game: makeGameResult 메서드에서 GameResult를 생성
- GameResult : getDelaerProfit 메서드를 Profit.reverse()와의 협력으로 구현
